# คู่มือใช้งาน CMS (Thai Haven Service)

เอกสารนี้อธิบายการใช้งาน CMS แบบละเอียดทุกฟังก์ชันที่มีในระบบปัจจุบัน

---

## 1) การเข้าใช้งาน

1. เปิดหน้า `/admin`
2. กรอกอีเมล + รหัสผ่าน
3. หากยังไม่เคยสมัคร ให้กด **สมัครบัญชี (ครั้งแรก)**  
   - ระบบใช้ Supabase Auth
4. เมื่อเข้าสู่ระบบสำเร็จ จะเห็นแดชบอร์ด CMS

> หมายเหตุ: ต้องตั้งค่า `.env.local` ให้ครบ (ดู `SUPABASE_SETUP.md`)

---

## 2) ภาพรวมหน้าแดชบอร์ด

เมนูด้านซ้ายมี 4 ส่วนหลัก:
- **บทความ**
- **บริการ**
- **สคริปต์ไซต์**
- **ตั้งค่าแบบฟอร์ม**

ด้านขวาเป็นรายการและตัวแก้ไข (popup)  
บนหัวหน้าแสดงจำนวนบทความออนไลน์/ออฟไลน์ และปุ่มเพิ่มรายการ

ปุ่มหลักที่พบบ่อย:
- **เพิ่มรายการ**: สร้างบทความ/บริการใหม่
- **ดู preview**: เปิดหน้าพรีวิวของรายการ
- **บันทึก**: เซฟการแก้ไข
- **ลบรายการ**: ลบรายการออก
- **ปิด**: ปิดหน้าต่างแก้ไข

---

## 3) บทความ (Articles)

### 3.1 รายการบทความ
- คลิกที่รายการเพื่อเปิดหน้าต่างแก้ไข
- มีตัวบอกสถานะ `draft` / `published`
- มีปุ่ม toggle เพื่อแสดง/ซ่อนบนหน้าเว็บทันที

### 3.2 ฟิลด์สำคัญ (แท็บ Content)

**หัวข้อหลัก**
- ชื่อเรื่อง
- Slug  
  - กดปุ่ม **Auto** เพื่อสร้าง slug อัตโนมัติ
- สถานะ (Draft / Published)
- รูปหลัก (URL หรืออัปโหลดไฟล์)
- คำโปรย (Summary)

**หมวดหมู่ (สูงสุด 3)**
- เลือกจากรายการที่มี
- เพิ่มหมวดใหม่ พร้อมเลือกสีหมวด

**วันที่**
- เลือกวันเผยแพร่

**เนื้อหา (Rich Text)**
- ใช้ตัวแก้ไข WYSIWYG
- รองรับหัวข้อ/ย่อหน้า/ลิงก์/ตัวหนา/ตัวเอียง

**CTA (แสดงที่ท้ายบทความ)**
- CTA หัวข้อ
- CTA คำอธิบาย
- CTA ปุ่ม (ข้อความ)
- CTA ลิงก์

> CTA จะถูกแสดงด้วยดีไซน์ ReadyCTA ในหน้าอ่านบทความจริง

### 3.3 แท็บ Meta keyword
ใส่คีย์เวิร์ด SEO (คั่นด้วย comma)

---

## 4) บริการ (Services)

### 4.1 รายการบริการ
สามารถ “ลากเพื่อเรียงลำดับ” ได้  
ลำดับจะถูกใช้ในหน้าแสดงผลบริการ (หน้ารวมบริการ/หน้าแรก)

มีปุ่ม **รีเฟรชหน้าเว็บ** เพื่อเรียก revalidate (ต้องตั้งค่า `NEXT_PUBLIC_REVALIDATE_SECRET`)

### 4.2 แท็บแก้ไขบริการ (Service Editor)
การแก้ไขบริการแบ่งเป็นหลาย section (แท็บด้านบน) เพื่อให้แก้ได้ง่าย

**Hero**
- สถานะ (Draft / Published)
- คำเรียกบริการ (service label) → จะอัปเดตชื่อบริการ
- Slug (มีปุ่ม Auto)
- หัวข้อหลัก
- คำอธิบาย
- รูปภาพหลัก (URL + alt)

**Intro**
- หัวข้อ
- รูปประกอบ (URL + alt)
- รายการคำอธิบาย (เพิ่ม/ลบได้)

**ประเภทบริการ (Types)**
- หัวข้อหลัก + eyebrow
- รายการประเภท (เพิ่ม/ลบได้)
  - ชื่อประเภท
  - คำอธิบาย
  - รูปภาพ (URL + alt)
  - รายการจุดเด่น/เหมาะสำหรับ (ข้อความเป็น list)

**วัสดุ/สี/ขนาด (Specs)**
- หัวข้อหลัก + eyebrow
- รูปภาพประกอบ (URL + alt)
- รายการวัสดุ/สี/ขนาด (list)

**แกลเลอรี**
- หัวข้อหลัก + subtitle + eyebrow
- รูปภาพในแกลเลอรี (เพิ่ม/ลบได้)

**บทความ**
- หัวข้อหลัก + subtitle + eyebrow
- เลือกบทความที่จะแสดงบนหน้า service

**FAQ**
- หัวข้อหลัก + eyebrow
- รายการคำถาม-คำตอบ (เพิ่ม/ลบได้)

> เมื่อแก้ไขเสร็จอย่าลืมกด **บันทึก**

---

## 5) สคริปต์ไซต์ (Site Scripts)

ใช้สำหรับแทรกโค้ด HTML/Script ลงใน `<head>` และ `<body>`
- Head Scripts: แทรกก่อนปิด `</head>`
- Body Scripts: แทรกหลังเปิด `<body>`

เหมาะสำหรับพวก:
- Pixel / Analytics
- Tag Manager
- Script จาก third-party

> ส่วนนี้เป็น raw HTML/Script ไม่มีการ escape ต้องระวังโค้ดผิด

---

## 6) ตั้งค่าแบบฟอร์ม (Form Settings)

ใช้ตั้งค่าให้ฟอร์มหน้า “ติดต่อเรา” ส่งข้อมูลลง Google Sheet ผ่าน Apps Script

**ฟิลด์ที่ตั้งค่าได้**
- Apps Script Web App URL
- ข้อความหลังส่งสำเร็จ

มีปุ่ม **วิธีใช้งานโดยละเอียด** สำหรับลูกค้า (มีโค้ด Apps Script ให้คัดลอก)

ข้อมูลที่ส่งจากฟอร์ม:
- `name`
- `email`
- `phone`
- `service_type`
- `message`

---

## 7) การพรีวิว

ทุกบทความ/บริการสามารถกด **ดู preview**  
- ใช้เพื่อดูหน้าแบบสดก่อนกดเผยแพร่
- บทความ: `/preview/articles/[slug]?id=...`
- บริการ: `/preview/services/[slug]?id=...`

---

## 8) สถานะการเผยแพร่

`Draft` = ไม่แสดงบนหน้าเว็บ  
`Published` = แสดงบนหน้าเว็บทันที

สามารถเปลี่ยนสถานะได้ทั้ง:
- ในหน้ารายการ (toggle)
- ในหน้าแก้ไข (select)

---

## 9) อัปโหลดรูป

ระบบอัปโหลดรูปไปยัง Supabase Storage (`cms-public`)
- รองรับการอัปโหลดผ่านช่อง “รูปหลัก (อัปโหลด)”
- ถ้ามี URL รูปอยู่แล้ว สามารถวาง URL ได้เลย

---

## 10) ปัญหาที่พบบ่อย

**1) เข้า CMS ไม่ได้**
- ตรวจสอบ `.env.local` ให้ถูกต้อง
- ต้องมี user ใน Supabase Auth และอีเมลต้องอยู่ใน `admin_users`

**2) บันทึกไม่สำเร็จ**
- ตรวจสอบสิทธิ์ admin
- เช็ค RLS policy ใน Supabase

**3) ข้อมูลไม่อัปเดตบนหน้าเว็บ**
- กด “รีเฟรชหน้าเว็บ”
- หรือรอ revalidate (60 วินาทีในหน้ารวมบทความ/บริการ)

---

## 11) ไฟล์ที่เกี่ยวข้อง (สำหรับทีมพัฒนา)

- Admin UI: `components/admin/MockCmsApp.jsx`
- Form settings: `components/ui/ContactForm.jsx`
- Article detail: `app/articles/[slug]/page.jsx`
- Service template: `components/services/ServiceTemplate.jsx`
- Schema: `supabase/schema.sql`
